<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Off</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- –ß—Ç–æ–±—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ –î–æ–º–æ–π –≤—ã–≥–ª—è–¥–µ–ª–æ –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Off">

  <style>
    :root {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      color-scheme: dark;
    }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: #000;
      color: #f5f5f5;
    }
    .screen {
      max-width: 430px;
      margin: 0 auto;
      padding: 16px 16px 32px;
    }

    /* –í–µ—Ä—Ö: –∑–∞–≥–æ–ª–æ–≤–æ–∫ + –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ */
    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 8px;
    }
    .header {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: #ff9500;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    .title-block {
      display: flex;
      flex-direction: column;
    }
    .title {
      font-size: 24px;
      font-weight: 700;
    }
    .subtitle {
      font-size: 14px;
      color: #aaa;
    }
    .badge {
      display: inline-flex;
      margin-top: 6px;
      padding: 3px 10px;
      border-radius: 999px;
      background: #222;
      font-size: 12px;
      color: #ccc;
    }

    .lang-switch {
      display: inline-flex;
      border-radius: 999px;
      background: #151515;
      padding: 2px;
      gap: 2px;
    }
    .lang-btn {
      border: none;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: transparent;
      color: #bbb;
      min-width: 32px;
    }
    .lang-btn.active {
      background: #ff9500;
      color: #000;
      font-weight: 600;
    }

    /* –ö–Ω–æ–ø–∫–∏ –¥–Ω–µ–π */
    .days-row {
      display: flex;
      justify-content: space-between;
      margin: 16px 0 8px;
    }
    .day-btn {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: none;
      background: #222;
      color: #ccc;
      font-size: 15px;
    }
    .day-btn.active {
      background: #ff9500;
      color: #fff;
      font-weight: 600;
    }

    /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ (–æ—Ç–∫–ª / —Å–≤–µ—Ç) ‚Äî –¥–ª—è —Å–ø–∏—Å–∫–∞ */
    .mode-switch {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
    }
    .mode-switch-inner {
      display: inline-flex;
      border-radius: 999px;
      background: #151515;
      padding: 3px;
      gap: 4px;
    }
    .mode-btn {
      border: none;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      background: transparent;
      color: #bbb;
      min-width: 70px;
    }
    .mode-btn.active {
      background: #ff9500;
      color: #000;
      font-weight: 600;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Å–ø–∏—Å–æ–∫ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤) */
    .card {
      background: #111;
      border-radius: 18px;
      padding: 8px 0 6px;
      overflow: hidden;
    }
    .slot-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 16px;
      font-size: 16px;
    }
    .slot-row:nth-child(odd) {
      background: #151515;
    }
    .slot-row.current {
      background: #262626;
    }
    .slot-time {
      color: #ffb84d; /* –∂—ë–ª—Ç—ã–π ‚Äì –∏ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏–π, –∏ –¥–ª—è "–µ—Å—Ç—å —Å–≤–µ—Ç" */
    }
    .slot-duration {
      color: #aaa;
      font-size: 14px;
    }
    .slot-label {
      color: #777;
      font-size: 13px;
    }

    /* –õ–µ–Ω—Ç–∞ "–∫–∞–∫ –≤ –°–≤—ñ—Ç–ª–æ" */
    .timeline {
      margin-top: 14px;
      padding: 10px 12px 8px;
      border-radius: 16px;
      background: #111;
      font-size: 12px;
    }
    .timeline-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .timeline-title {
      font-weight: 600;
      font-size: 13px;
    }
    .timeline-bar {
      display: flex;
      border-radius: 999px;
      overflow: hidden;
      height: 18px;
      background: #222;
    }
    .timeline-segment {
      flex: 1;
      background: #333;  /* –Ω–µ—Ç —Å–≤–µ—Ç–∞ */
    }
    .timeline-segment.on {
      background: #ffb84d; /* –µ—Å—Ç—å —Å–≤–µ—Ç */
    }
    .timeline-segment.now {
      outline: 2px solid #ffffff;
      outline-offset: -1px;
    }
    .timeline-hours {
      display: flex;
      justify-content: space-between;
      margin-top: 4px;
      color: #777;
      font-size: 11px;
    }
    .timeline-legend {
      margin-top: 4px;
      color: #888;
      font-size: 11px;
    }

    /* –°—Ç–∞—Ç—É—Å "—Å–µ–π—á–∞—Å" */
    .now-status {
      margin-top: 10px;
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 14px;
      background: #111;
      color: #ccc;
    }
    .now-status span {
      font-weight: 600;
    }

    .footer-note {
      margin-top: 10px;
      font-size: 12px;
      color: #777;
    }

    .edit-block {
      margin-top: 18px;
      padding: 12px 14px;
      border-radius: 14px;
      background: #111;
      font-size: 13px;
    }
    .edit-block textarea {
      width: 100%;
      min-height: 80px;
      margin-top: 6px;
      border-radius: 10px;
      border: 1px solid #333;
      padding: 8px;
      background: #000;
      color: #f5f5f5;
      font-size: 13px;
      font-family: monospace;
      resize: vertical;
    }
    .edit-block button {
      margin-top: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      background: #ff9500;
      color: #000;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
    }
  </style>
</head>
<body>
<div class="screen">
  <div class="top-row">
    <div class="header">
      <div class="icon">üí°</div>
      <div class="title-block">
        <div class="title" id="titleHome"></div>
        <div class="subtitle" id="subtitleRegion"></div>
        <div class="badge" id="queueBadge"></div>
      </div>
    </div>
    <div class="lang-switch">
      <button class="lang-btn" data-lang="ru">RU</button>
      <button class="lang-btn" data-lang="uk">UA</button>
    </div>
  </div>

  <div class="days-row" id="daysRow"></div>

  <div class="mode-switch">
    <div class="mode-switch-inner">
      <button class="mode-btn" data-mode="off">–û—Ç–∫–ª—é—á–µ–Ω–∏—è</button>
      <button class="mode-btn" data-mode="on">–ï—Å—Ç—å —Å–≤–µ—Ç</button>
    </div>
  </div>

  <div class="card" id="slotsContainer"></div>

  <div class="timeline" id="timelineBlock">
    <div class="timeline-header-row">
      <div class="timeline-title" id="timelineTitle"></div>
    </div>
    <div class="timeline-bar" id="timelineBar"></div>
    <div class="timeline-hours">
      <span>00</span><span>06</span><span>12</span><span>18</span><span>24</span>
    </div>
    <div class="timeline-legend" id="timelineLegend"></div>
  </div>

  <div class="now-status" id="nowStatus"></div>

  <div class="footer-note" id="footerNote"></div>

  <div class="edit-block">
    <div id="editTitle"></div>
    <textarea id="editArea"></textarea>
    <button id="saveBtn"></button>
  </div>
</div>

<script>
  // ----- I18N -----
  const i18n = {
    ru: {
      title_home: '–î–æ–º',
      region: '–ù–∏–∫–æ–ª–∞–µ–≤—Å–∫–∞—è –æ–±–ª.',
      queue_badge: '–û—á–µ—Ä–µ–¥—å 6.2',
      day_mon: '–ü–Ω',
      day_tue: '–í—Ç',
      day_wed: '–°—Ä',
      day_thu: '–ß—Ç',
      day_fri: '–ü—Ç',
      day_sat: '–°–±',
      day_sun: '–í—Å',
      footer_note: '–ì—Ä–∞—Ñ–∏–∫ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (localStorage). –§–æ—Ä–º–∞—Ç: HH:MM-HH:MM;HH:MM-HH:MM',
      edit_title: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è:',
      save_btn: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è –¥–Ω—è',
      slot_label_off: '–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ',
      slot_label_on: '–µ—Å—Ç—å —Å–≤–µ—Ç',
      now_loading: '–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶',
      now_prefix: '–°–µ–π—á–∞—Å',
      now_off: '–ú–û–ñ–ï–¢ –ù–ï –ë–´–¢–¨ –°–í–ï–¢–ê',
      now_ok: '–≤–Ω–µ –≥—Ä–∞—Ñ–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π',
      now_time: '–≤—Ä–µ–º—è',
      mode_off: '–û—Ç–∫–ª—é—á–µ–Ω–∏—è',
      mode_on: '–ï—Å—Ç—å —Å–≤–µ—Ç',
      tl_title: '–°—É—Ç–∫–∏: –∂—ë–ª—Ç—ã–º ‚Äî –∫–æ–≥–¥–∞ –µ—Å—Ç—å —Å–≤–µ—Ç',
      tl_legend: '–ñ—ë–ª—Ç—ã–π ‚Äî –µ—Å—Ç—å —Å–≤–µ—Ç, —Å–µ—Ä—ã–π ‚Äî –Ω–µ—Ç —Å–≤–µ—Ç–∞',
    },
    uk: {
      title_home: '–î—ñ–º',
      region: '–ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞ –æ–±–ª.',
      queue_badge: '–ß–µ—Ä–≥–∞ 6.2',
      day_mon: '–ü–Ω',
      day_tue: '–í—Ç',
      day_wed: '–°—Ä',
      day_thu: '–ß—Ç',
      day_fri: '–ü—Ç',
      day_sat: '–°–±',
      day_sun: '–ù–¥',
      footer_note: '–ì—Ä–∞—Ñ—ñ–∫ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –Ω–∞ —Ü—å–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó (localStorage). –§–æ—Ä–º–∞—Ç: HH:MM-HH:MM;HH:MM-HH:MM',
      edit_title: '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –¥–ª—è –æ–±—Ä–∞–Ω–æ–≥–æ –¥–Ω—è:',
      save_btn: '–ó–±–µ—Ä–µ–≥—Ç–∏ –¥–ª—è –¥–Ω—è',
      slot_label_off: '–≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è',
      slot_label_on: '—î —Å–≤—ñ—Ç–ª–æ',
      now_loading: '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶',
      now_prefix: '–ó–∞—Ä–∞–∑',
      now_off: '–ú–û–ñ–ï –ù–ï –ë–£–¢–ò –°–í–Ü–¢–õ–ê',
      now_ok: '–ø–æ–∑–∞ –≥—Ä–∞—Ñ—ñ–∫–æ–º –≤—ñ–¥–∫–ª—é—á–µ–Ω—å',
      now_time: '—á–∞—Å',
      mode_off: '–í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è',
      mode_on: '–Ñ —Å–≤—ñ—Ç–ª–æ',
      tl_title: '–î–æ–±–∞: –∂–æ–≤—Ç–∏–º ‚Äî –∫–æ–ª–∏ —î —Å–≤—ñ—Ç–ª–æ',
      tl_legend: '–ñ–æ–≤—Ç–∏–π ‚Äî —î —Å–≤—ñ—Ç–ª–æ, —Å—ñ—Ä–∏–π ‚Äî –Ω–µ–º–∞—î —Å–≤—ñ—Ç–ª–∞',
    }
  };

  const STORAGE_KEY = 'offlight_schedule_62';
  const LANG_KEY = 'offlight_lang';
  const MODE_KEY = 'offlight_mode';

  const days = [
    {key: 'mon', labelKey: 'day_mon'},
    {key: 'tue', labelKey: 'day_tue'},
    {key: 'wed', labelKey: 'day_wed'},
    {key: 'thu', labelKey: 'day_thu'},
    {key: 'fri', labelKey: 'day_fri'},
    {key: 'sat', labelKey: 'day_sat'},
    {key: 'sun', labelKey: 'day_sun'},
  ];

  const defaultDaySlots = [
    ['00:00', '01:00'],
    ['08:00', '15:00'],
    ['18:30', '22:00'],
  ];

  let currentLang = localStorage.getItem(LANG_KEY) || 'ru';
  let currentMode = localStorage.getItem(MODE_KEY) || 'off'; // 'off' –∏–ª–∏ 'on'

  function t(key) {
    return (i18n[currentLang] && i18n[currentLang][key])
      || (i18n['ru'] && i18n['ru'][key])
      || key;
  }

  function getTodayKey() {
    const jsDay = new Date().getDay();
    switch (jsDay) {
      case 0: return 'sun';
      case 1: return 'mon';
      case 2: return 'tue';
      case 3: return 'wed';
      case 4: return 'thu';
      case 5: return 'fri';
      case 6: return 'sat';
    }
  }

  function loadSchedule() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) {
      const obj = {};
      days.forEach(d => obj[d.key] = defaultDaySlots.slice());
      return obj;
    }
    try {
      const parsed = JSON.parse(raw);
      days.forEach(d => {
        if (!Array.isArray(parsed[d.key])) parsed[d.key] = defaultDaySlots.slice();
      });
      return parsed;
    } catch (e) {
      const obj = {};
      days.forEach(d => obj[d.key] = defaultDaySlots.slice());
      return obj;
    }
  }

  function saveSchedule(schedule) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(schedule));
  }

  let schedule = loadSchedule();
  let currentDayKey = getTodayKey();

  const daysRow = document.getElementById('daysRow');
  const slotsContainer = document.getElementById('slotsContainer');
  const nowStatus = document.getElementById('nowStatus');
  const footerNote = document.getElementById('footerNote');
  const editTitle = document.getElementById('editTitle');
  const editArea = document.getElementById('editArea');
  const saveBtn = document.getElementById('saveBtn');
  const timelineBar = document.getElementById('timelineBar');
  const timelineTitle = document.getElementById('timelineTitle');
  const timelineLegend = document.getElementById('timelineLegend');

  function parseTimeToMinutes(t) {
    const [h, m] = t.split(':').map(Number);
    return h * 60 + m;
  }

  function minutesToTime(m) {
    m = (m + 1440) % 1440;
    const h = Math.floor(m / 60);
    const mm = m % 60;
    const hhStr = String(h).padStart(2, '0');
    const mmStr = String(mm).padStart(2, '0');
    return `${hhStr}:${mmStr}`;
  }

  function formatDuration(start, end) {
    let s = parseTimeToMinutes(start);
    let e = parseTimeToMinutes(end);
    if (e <= s) e += 24 * 60;
    const mins = e - s;
    const hours = Math.floor(mins / 60);
    const rest = mins % 60;
    if (currentLang === 'ru') {
      let res = '';
      if (hours > 0) res += hours + '—á';
      if (rest > 0) res += (res ? ' ' : '') + rest + '–º–∏–Ω';
      if (!res) res = '0–º–∏–Ω';
      return res;
    } else {
      let res = '';
      if (hours > 0) res += hours + '–≥';
      if (rest > 0) res += (res ? ' ' : '') + rest + '—Ö–≤';
      if (!res) res = '0—Ö–≤';
      return res;
    }
  }

  function isNowInSlot(start, end) {
    const now = new Date();
    const minutesNow = now.getHours() * 60 + now.getMinutes();
    let s = parseTimeToMinutes(start);
    let e = parseTimeToMinutes(end);
    if (e <= s) e += 24 * 60;
    return minutesNow >= s && minutesNow <= e;
  }

  // –ü–µ—Ä–µ–≤–æ–¥ —Å–ø–∏—Å–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π –≤ —Å–ø–∏—Å–æ–∫ "–µ—Å—Ç—å —Å–≤–µ—Ç"
  function getOnSlots(offSlots) {
    // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã, —É—á–∏—Ç—ã–≤–∞—è –ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å
    let intervals = [];
    offSlots.forEach(([start, end]) => {
      let s = parseTimeToMinutes(start);
      let e = parseTimeToMinutes(end);
      if (e <= s) {
        // –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –ø–æ–ª—É–Ω–æ—á–∏: [s, 1440) –∏ [0, e)
        intervals.push([s, 1440]);
        intervals.push([0, e]);
      } else {
        intervals.push([s, e]);
      }
    });

    // –°–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
    intervals.sort((a, b) => a[0] - b[0]);
    let merged = [];
    for (const [s, e] of intervals) {
      if (!merged.length) {
        merged.push([s, e]);
      } else {
        const last = merged[merged.length - 1];
        if (s <= last[1]) {
          last[1] = Math.max(last[1], e);
        } else {
          merged.push([s, e]);
        }
      }
    }

    // –°—Ç—Ä–æ–∏–º "—Å–≤–µ—Ç" –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ 0..1440
    let on = [];
    let cur = 0;
    for (const [s, e] of merged) {
      if (s > cur) {
        on.push([cur, s]);
      }
      cur = Math.max(cur, e);
    }
    if (cur < 1440) {
      on.push([cur, 1440]);
    }

    // –ü–µ—Ä–µ–≤–æ–¥–∏–º –Ω–∞–∑–∞–¥ –≤ HH:MM
    return on.map(([s, e]) => [minutesToTime(s), minutesToTime(e === 1440 ? 1439 : e)]);
  }

  // –õ–µ–Ω—Ç–∞ "–∫–∞–∫ –≤ –°–≤—ñ—Ç–ª–æ" ‚Äî 24 —Å–µ–≥–º–µ–Ω—Ç–∞ –ø–æ —á–∞—Å–∞–º
  function renderTimeline() {
    const offSlots = schedule[currentDayKey] || [];
    const minutesOff = new Array(1440).fill(false);

    // –∑–∞–ø–æ–ª–Ω—è–µ–º –º–∏–Ω—É—Ç—ã, –≥–¥–µ –ù–ï–¢ —Å–≤–µ—Ç–∞
    offSlots.forEach(([start, end]) => {
      let s = parseTimeToMinutes(start);
      let e = parseTimeToMinutes(end);
      if (e <= s) {
        // —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å
        for (let m = s; m < 1440; m++) minutesOff[m] = true;
        for (let m = 0; m < e; m++) minutesOff[m] = true;
      } else {
        for (let m = s; m < e; m++) minutesOff[m] = true;
      }
    });

    const now = new Date();
    const nowHour = now.getHours();

    timelineBar.innerHTML = '';
    for (let h = 0; h < 24; h++) {
      const center = h * 60 + 30;
      const off = minutesOff[center];
      const seg = document.createElement('div');
      seg.className = 'timeline-segment' + (off ? '' : ' on');
      if (h === nowHour) {
        seg.className += ' now';
      }
      timelineBar.appendChild(seg);
    }

    timelineTitle.textContent = t('tl_title');
    timelineLegend.textContent = t('tl_legend');
  }

  function renderLangTexts() {
    document.getElementById('titleHome').textContent = t('title_home');
    document.getElementById('subtitleRegion').textContent = t('region');
    document.getElementById('queueBadge').textContent = t('queue_badge');
    footerNote.innerHTML = t('footer_note');
    editTitle.textContent = t('edit_title');
    saveBtn.textContent = t('save_btn');
    nowStatus.textContent = t('now_loading');

    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.lang === currentLang);
    });

    document.querySelectorAll('.day-btn').forEach(btn => {
      const key = btn.dataset.dayKey;
      const d = days.find(x => x.key === key);
      btn.textContent = t(d.labelKey);
    });

    document.querySelectorAll('.mode-btn').forEach(btn => {
      const mode = btn.dataset.mode;
      const key = mode === 'off' ? 'mode_off' : 'mode_on';
      btn.textContent = t(key);
      btn.classList.toggle('active', mode === currentMode);
    });

    // –∑–∞–≥–æ–ª–æ–≤–∫–∏/–ª–µ–≥–µ–Ω–¥–∞ –ª–µ–Ω—Ç—ã
    timelineTitle.textContent = t('tl_title');
    timelineLegend.textContent = t('tl_legend');
  }

  function renderDays() {
    document.querySelectorAll('.day-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.dayKey === currentDayKey);
    });
  }

  function renderSlots() {
    const offSlots = schedule[currentDayKey] || [];
    let slotsToShow;
    let labelKey;

    if (currentMode === 'off') {
      slotsToShow = offSlots;
      labelKey = 'slot_label_off';
    } else {
      slotsToShow = getOnSlots(offSlots);
      labelKey = 'slot_label_on';
    }

    slotsContainer.innerHTML = '';

    slotsToShow.forEach(([start, end]) => {
      const row = document.createElement('div');
      const current = isNowInSlot(start, end);
      row.className = 'slot-row' + (current ? ' current' : '');

      const left = document.createElement('div');
      left.innerHTML = `<div class="slot-time">${start} ‚Äì ${end}</div>`;

      const right = document.createElement('div');
      right.innerHTML = `<div class="slot-duration">${formatDuration(start, end)}</div>
                         <div class="slot-label">${t(labelKey)}</div>`;

      row.appendChild(left);
      row.appendChild(right);
      slotsContainer.appendChild(row);
    });

    // –í –ø–æ–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –û–¢–ö–õ–Æ–ß–ï–ù–ò–Ø, –∫–∞–∫ —Ä–∞–Ω—å—à–µ
    editArea.value = offSlots.map(s => s.join('-')).join(';');
  }

  function renderNowStatus() {
    const now = new Date();
    const slotsToday = schedule[getTodayKey()] || [];
    let inSlot = false;
    let currentSlot = null;
    for (const [start, end] of slotsToday) {
      if (isNowInSlot(start, end)) {
        inSlot = true;
        currentSlot = [start, end];
        break;
      }
    }
    const timeStr = now.toTimeString().slice(0, 5);
    if (inSlot) {
      nowStatus.innerHTML =
        `${t('now_prefix')} <span>${t('now_off')}</span> (${currentSlot[0]}‚Äì${currentSlot[1]}), ${t('now_time')} ${timeStr}`;
    } else {
      nowStatus.innerHTML =
        `${t('now_prefix')} <span>${t('now_ok')}</span>, ${t('now_time')} ${timeStr}`;
    }
  }

  function renderAll() {
    renderLangTexts();
    renderDays();
    renderSlots();
    renderTimeline();
    renderNowStatus();
  }

  // –ö–Ω–æ–ø–∫–∏ –¥–Ω–µ–π
  days.forEach(d => {
    const btn = document.createElement('button');
    btn.className = 'day-btn';
    btn.dataset.dayKey = d.key;
    btn.addEventListener('click', () => {
      currentDayKey = d.key;
      renderAll();
    });
    daysRow.appendChild(btn);
  });

  // –°–º–µ–Ω–∞ —è–∑—ã–∫–∞
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const lang = btn.dataset.lang;
      if (lang === currentLang) return;
      currentLang = lang;
      localStorage.setItem(LANG_KEY, lang);
      renderAll();
    });
  });

  // –°–º–µ–Ω–∞ —Ä–µ–∂–∏–º–∞ (–û—Ç–∫–ª—é—á–µ–Ω–∏—è / –ï—Å—Ç—å —Å–≤–µ—Ç) ‚Äî –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–ø–∏—Å–æ–∫
  document.querySelectorAll('.mode-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const mode = btn.dataset.mode;
      if (mode === currentMode) return;
      currentMode = mode;
      localStorage.setItem(MODE_KEY, mode);
      renderAll();
    });
  });

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ (—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –≤—Å–µ–≥–¥–∞ –û–¢–ö–õ–Æ–ß–ï–ù–ò–Ø)
  saveBtn.addEventListener('click', () => {
    const text = editArea.value.trim();
    const parts = text ? text.split(';') : [];
    const slots = [];
    for (const p of parts) {
      const trimmed = p.trim();
      if (!trimmed) continue;
      const [start, end] = trimmed.split('-').map(x => x.trim());
      if (!start || !end) continue;
      slots.push([start, end]);
    }
    schedule[currentDayKey] = slots;
    saveSchedule(schedule);
    renderAll();
  });

  renderAll();
  setInterval(() => {
    renderNowStatus();
    renderTimeline();
  }, 60000);
</script>
</body>
</html>
