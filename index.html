<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Off</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- –ß—Ç–æ–±—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ –î–æ–º–æ–π –≤—ã–≥–ª—è–¥–µ–ª–æ –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Off">

  <style>
    :root {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      color-scheme: dark;
    }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: #000;
      color: #f5f5f5;
    }
    .screen {
      max-width: 430px;
      margin: 0 auto;
      padding: 16px 16px 32px;
    }

    /* –í–µ—Ä—Ö: –∑–∞–≥–æ–ª–æ–≤–æ–∫ + –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ */
    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 8px;
    }
    .header {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: #ff9500;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    .title-block {
      display: flex;
      flex-direction: column;
    }
    .title {
      font-size: 24px;
      font-weight: 700;
    }
    .subtitle {
      font-size: 14px;
      color: #aaa;
    }
    .badge {
      display: inline-flex;
      margin-top: 6px;
      padding: 3px 10px;
      border-radius: 999px;
      background: #222;
      font-size: 12px;
      color: #ccc;
    }

    .lang-switch {
      display: inline-flex;
      border-radius: 999px;
      background: #151515;
      padding: 2px;
      gap: 2px;
    }
    .lang-btn {
      border: none;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: transparent;
      color: #bbb;
      min-width: 32px;
    }
    .lang-btn.active {
      background: #ff9500;
      color: #000;
      font-weight: 600;
    }

    /* –ö–Ω–æ–ø–∫–∏ –¥–Ω–µ–π */
    .days-row {
      display: flex;
      justify-content: space-between;
      margin: 16px 0 12px;
    }
    .day-btn {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: none;
      background: #222;
      color: #ccc;
      font-size: 15px;
    }
    .day-btn.active {
      background: #ff9500;
      color: #fff;
      font-weight: 600;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è */
    .card {
      background: #111;
      border-radius: 18px;
      padding: 8px 0 6px;
      overflow: hidden;
    }
    .slot-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 16px;
      font-size: 16px;
    }
    .slot-row:nth-child(odd) {
      background: #151515;
    }
    .slot-row.current {
      background: #262626;
    }
    .slot-time {
      color: #ffb84d;
    }
    .slot-duration {
      color: #aaa;
      font-size: 14px;
    }
    .slot-label {
      color: #777;
      font-size: 13px;
    }

    /* –°—Ç–∞—Ç—É—Å "—Å–µ–π—á–∞—Å" */
    .now-status {
      margin-top: 10px;
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 14px;
      background: #111;
      color: #ccc;
    }
    .now-status span {
      font-weight: 600;
    }

    .footer-note {
      margin-top: 10px;
      font-size: 12px;
      color: #777;
    }

    .edit-block {
      margin-top: 18px;
      padding: 12px 14px;
      border-radius: 14px;
      background: #111;
      font-size: 13px;
    }
    .edit-block textarea {
      width: 100%;
      min-height: 80px;
      margin-top: 6px;
      border-radius: 10px;
      border: 1px solid #333;
      padding: 8px;
      background: #000;
      color: #f5f5f5;
      font-size: 13px;
      font-family: monospace;
      resize: vertical;
    }
    .edit-block button {
      margin-top: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      background: #ff9500;
      color: #000;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
    }
  </style>
</head>
<body>
<div class="screen">
  <div class="top-row">
    <div class="header">
      <div class="icon">üí°</div>
      <div class="title-block">
        <div class="title" id="titleHome"></div>
        <div class="subtitle" id="subtitleRegion"></div>
        <div class="badge" id="queueBadge"></div>
      </div>
    </div>
    <div class="lang-switch">
      <button class="lang-btn" data-lang="ru">RU</button>
      <button class="lang-btn" data-lang="uk">UA</button>
    </div>
  </div>

  <div class="days-row" id="daysRow"></div>

  <div class="card" id="slotsContainer"></div>

  <div class="now-status" id="nowStatus"></div>

  <div class="footer-note" id="footerNote"></div>

  <div class="edit-block">
    <div id="editTitle"></div>
    <textarea id="editArea"></textarea>
    <button id="saveBtn"></button>
  </div>
</div>

<script>
  // ----- I18N -----
  const i18n = {
    ru: {
      title_home: '–î–æ–º',
      region: '–ù–∏–∫–æ–ª–∞–µ–≤—Å–∫–∞—è –æ–±–ª.',
      queue_badge: '–û—á–µ—Ä–µ–¥—å 6.2',
      day_mon: '–ü–Ω',
      day_tue: '–í—Ç',
      day_wed: '–°—Ä',
      day_thu: '–ß—Ç',
      day_fri: '–ü—Ç',
      day_sat: '–°–±',
      day_sun: '–í—Å',
      footer_note: '–ì—Ä–∞—Ñ–∏–∫ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (localStorage). –§–æ—Ä–º–∞—Ç: HH:MM-HH:MM;HH:MM-HH:MM',
      edit_title: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è:',
      save_btn: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è –¥–Ω—è',
      slot_label_off: '–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ',
      now_loading: '–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶',
      now_prefix: '–°–µ–π—á–∞—Å',
      now_off: '–ú–û–ñ–ï–¢ –ù–ï –ë–´–¢–¨ –°–í–ï–¢–ê',
      now_ok: '–≤–Ω–µ –≥—Ä–∞—Ñ–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π',
      now_time: '–≤—Ä–µ–º—è',
    },
    uk: {
      title_home: '–î—ñ–º',
      region: '–ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞ –æ–±–ª.',
      queue_badge: '–ß–µ—Ä–≥–∞ 6.2',
      day_mon: '–ü–Ω',
      day_tue: '–í—Ç',
      day_wed: '–°—Ä',
      day_thu: '–ß—Ç',
      day_fri: '–ü—Ç',
      day_sat: '–°–±',
      day_sun: '–ù–¥',
      footer_note: '–ì—Ä–∞—Ñ—ñ–∫ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –Ω–∞ —Ü—å–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó (localStorage). –§–æ—Ä–º–∞—Ç: HH:MM-HH:MM;HH:MM-HH:MM',
      edit_title: '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –¥–ª—è –æ–±—Ä–∞–Ω–æ–≥–æ –¥–Ω—è:',
      save_btn: '–ó–±–µ—Ä–µ–≥—Ç–∏ –¥–ª—è –¥–Ω—è',
      slot_label_off: '–≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è',
      now_loading: '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶',
      now_prefix: '–ó–∞—Ä–∞–∑',
      now_off: '–ú–û–ñ–ï –ù–ï –ë–£–¢–ò –°–í–Ü–¢–õ–ê',
      now_ok: '–ø–æ–∑–∞ –≥—Ä–∞—Ñ—ñ–∫–æ–º –≤—ñ–¥–∫–ª—é—á–µ–Ω—å',
      now_time: '—á–∞—Å',
    }
  };

  const STORAGE_KEY = 'offlight_schedule_62';
  const LANG_KEY = 'offlight_lang';
  const days = [
    {key: 'mon', labelKey: 'day_mon'},
    {key: 'tue', labelKey: 'day_tue'},
    {key: 'wed', labelKey: 'day_wed'},
    {key: 'thu', labelKey: 'day_thu'},
    {key: 'fri', labelKey: 'day_fri'},
    {key: 'sat', labelKey: 'day_sat'},
    {key: 'sun', labelKey: 'day_sun'},
  ];

  const defaultDaySlots = [
    ['00:00', '01:00'],
    ['08:00', '15:00'],
    ['18:30', '22:00'],
  ];

  let currentLang = localStorage.getItem(LANG_KEY) || 'ru';

  function t(key) {
    return (i18n[currentLang] && i18n[currentLang][key])
      || (i18n['ru'] && i18n['ru'][key])
      || key;
  }

  function getTodayKey() {
    const jsDay = new Date().getDay();
    switch (jsDay) {
      case 0: return 'sun';
      case 1: return 'mon';
      case 2: return 'tue';
      case 3: return 'wed';
      case 4: return 'thu';
      case 5: return 'fri';
      case 6: return 'sat';
    }
  }

  function loadSchedule() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) {
      const obj = {};
      days.forEach(d => obj[d.key] = defaultDaySlots.slice());
      return obj;
    }
    try {
      const parsed = JSON.parse(raw);
      days.forEach(d => {
        if (!Array.isArray(parsed[d.key])) parsed[d.key] = defaultDaySlots.slice();
      });
      return parsed;
    } catch (e) {
      const obj = {};
      days.forEach(d => obj[d.key] = defaultDaySlots.slice());
      return obj;
    }
  }

  function saveSchedule(schedule) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(schedule));
  }

  let schedule = loadSchedule();
  let currentDayKey = getTodayKey();

  const daysRow = document.getElementById('daysRow');
  const slotsContainer = document.getElementById('slotsContainer');
  const nowStatus = document.getElementById('nowStatus');
  const footerNote = document.getElementById('footerNote');
  const editTitle = document.getElementById('editTitle');
  const editArea = document.getElementById('editArea');
  const saveBtn = document.getElementById('saveBtn');

  function parseTimeToMinutes(t) {
    const [h, m] = t.split(':').map(Number);
    return h * 60 + m;
  }

  function formatDuration(start, end) {
    let s = parseTimeToMinutes(start);
    let e = parseTimeToMinutes(end);
    if (e <= s) e += 24 * 60;
    const mins = e - s;
    const hours = Math.floor(mins / 60);
    const rest = mins % 60;
    if (currentLang === 'ru') {
      let res = '';
      if (hours > 0) res += hours + '—á';
      if (rest > 0) res += (res ? ' ' : '') + rest + '–º–∏–Ω';
      if (!res) res = '0–º–∏–Ω';
      return res;
    } else {
      let res = '';
      if (hours > 0) res += hours + '–≥';
      if (rest > 0) res += (res ? ' ' : '') + rest + '—Ö–≤';
      if (!res) res = '0—Ö–≤';
      return res;
    }
  }

  function isNowInSlot(start, end) {
    const now = new Date();
    const minutesNow = now.getHours() * 60 + now.getMinutes();
    let s = parseTimeToMinutes(start);
    let e = parseTimeToMinutes(end);
    if (e <= s) e += 24 * 60;
    return minutesNow >= s && minutesNow <= e;
  }

  function renderLangTexts() {
    document.getElementById('titleHome').textContent = t('title_home');
    document.getElementById('subtitleRegion').textContent = t('region');
    document.getElementById('queueBadge').textContent = t('queue_badge');
    footerNote.innerHTML = t('footer_note');
    editTitle.textContent = t('edit_title');
    saveBtn.textContent = t('save_btn');
    nowStatus.textContent = t('now_loading');

    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.lang === currentLang);
    });

    document.querySelectorAll('.day-btn').forEach(btn => {
      const key = btn.dataset.dayKey;
      const d = days.find(x => x.key === key);
      btn.textContent = t(d.labelKey);
    });
  }

  function renderDays() {
    document.querySelectorAll('.day-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.dayKey === currentDayKey);
    });
  }

  function renderSlots() {
    const slots = schedule[currentDayKey] || [];
    slotsContainer.innerHTML = '';

    slots.forEach(([start, end]) => {
      const row = document.createElement('div');
      const current = isNowInSlot(start, end);
      row.className = 'slot-row' + (current ? ' current' : '');

      const left = document.createElement('div');
      left.innerHTML = `<div class="slot-time">${start} ‚Äì ${end}</div>`;

      const right = document.createElement('div');
      right.innerHTML = `<div class="slot-duration">${formatDuration(start, end)}</div>
                         <div class="slot-label">${t('slot_label_off')}</div>`;

      row.appendChild(left);
      row.appendChild(right);
      slotsContainer.appendChild(row);
    });

    editArea.value = slots.map(s => s.join('-')).join(';');
  }

  function renderNowStatus() {
    const now = new Date();
    const slotsToday = schedule[getTodayKey()] || [];
    let inSlot = false;
    let currentSlot = null;
    for (const [start, end] of slotsToday) {
      if (isNowInSlot(start, end)) {
        inSlot = true;
        currentSlot = [start, end];
        break;
      }
    }
    const timeStr = now.toTimeString().slice(0, 5);
    if (inSlot) {
      nowStatus.innerHTML =
        `${t('now_prefix')} <span>${t('now_off')}</span> (${currentSlot[0]}‚Äì${currentSlot[1]}), ${t('now_time')} ${timeStr}`;
    } else {
      nowStatus.innerHTML =
        `${t('now_prefix')} <span>${t('now_ok')}</span>, ${t('now_time')} ${timeStr}`;
    }
  }

  function renderAll() {
    renderLangTexts();
    renderDays();
    renderSlots();
    renderNowStatus();
  }

  // –ö–Ω–æ–ø–∫–∏ –¥–Ω–µ–π
  days.forEach(d => {
    const btn = document.createElement('button');
    btn.className = 'day-btn';
    btn.dataset.dayKey = d.key;
    btn.addEventListener('click', () => {
      currentDayKey = d.key;
      renderAll();
    });
    daysRow.appendChild(btn);
  });

  // –°–º–µ–Ω–∞ —è–∑—ã–∫–∞
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const lang = btn.dataset.lang;
      if (lang === currentLang) return;
      currentLang = lang;
      localStorage.setItem(LANG_KEY, lang);
      renderAll();
    });
  });

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
  saveBtn.addEventListener('click', () => {
    const text = editArea.value.trim();
    const parts = text ? text.split(';') : [];
    const slots = [];
    for (const p of parts) {
      const trimmed = p.trim();
      if (!trimmed) continue;
      const [start, end] = trimmed.split('-').map(x => x.trim());
      if (!start || !end) continue;
      slots.push([start, end]);
    }
    schedule[currentDayKey] = slots;
    saveSchedule(schedule);
    renderAll();
  });

  renderAll();
  setInterval(renderNowStatus, 60000);
</script>
</body>
</html>
